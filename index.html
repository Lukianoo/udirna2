<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Ud√≠rna ‚Äì ≈ò√≠dic√≠ panel</title>

<style>
body{
  background:radial-gradient(circle at top,#2a2a2a,#000);
  color:#eee;
  font-family:Arial,sans-serif;
  margin:0;
}
#fs_btn_container{text-align:center;background:#111;padding:8px;}
#fs_btn{
  font-size:18px;padding:8px 15px;border-radius:8px;
  border:none;background:#ff7800;font-weight:bold;cursor:pointer;
}
#container{
  display:flex;flex-wrap:wrap;justify-content:center;
  align-items:flex-start;gap:20px;margin-top:20px;padding:10px;
}
.box{
  background:rgba(0,0,0,.65);
  border-radius:18px;
  box-shadow:0 0 30px rgba(255,120,0,.35);
  padding:15px;text-align:center;
  flex:1 1 300px;max-width:520px;
  display:flex;flex-direction:column;align-items:center;
}
.gauge{width:280px;height:280px;}
.gauge.big{width:420px;height:420px;}
.state,.time{text-align:center;width:100%}
.time{color:#00d9ff;font-size:20px}
#wifi_time{font-size:28px}
.ok{color:#00ff66}
.warn{color:#ffaa00}
.bad{color:#ff3333}
.recommend{color:#ffcc66}
input,button{width:90%;padding:6px;border-radius:6px;margin-top:6px}
.sound-controls{display:flex;gap:5px}
hr{border:1px solid #333;margin:10px 0;}
.blink{animation:blink 1s infinite}
@keyframes blink{0%,50%,100%{opacity:1}25%,75%{opacity:.3}}
</style>
</head>

<body>

<div id="fs_btn_container">
  <button id="fs_btn">Fullscreen</button>
</div>

<div id="container">

  <!-- WIFI -->
  <div class="box">
    <div id="rssi_gauge" class="gauge"></div>
    <div id="signal_state" class="state"></div>
    <div id="wifi_time" class="time"></div>
  </div>

  <!-- HLAVN√ç TEPLOTA -->
  <div class="box">
    <div id="temp_gauge" class="gauge big"></div>
    <div id="smoke_state" class="state"></div>
    <div id="smoke_time" class="time"></div>
    <div class="recommend" id="recommend"></div>
    <div class="state" id="meat_state"></div>
    <hr>

    <div>Minim√°ln√≠ teplota alarm (¬∞C)</div>
    <input type="number" id="temp_min" value="75">

    <div class="sound-controls">
      <label><input type="checkbox" id="sound_enable"> üîî P√≠pnut√≠</label>
      <button onclick="testSound(400)">Test</button>
    </div>

    <div>Maxim√°ln√≠ teplota alarm (¬∞C)</div>
    <input type="number" id="temp_max" value="85">

    <div class="sound-controls">
      <button onclick="testSound(600)">Test</button>
    </div>
  </div>

  <!-- VENEK -->
  <div class="box">
    <div id="temp2_gauge" class="gauge"></div>
    <div class="state">üå°Ô∏è Teplota venku</div>
  </div>

</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

<script>
class NiceGauge{
  constructor(el,min,max,unit,zones=[],bands=[]){
    this.min=min;this.max=max;this.unit=unit;
    this.zones=zones;this.bands=bands;

    el.innerHTML=`
    <svg viewBox="0 0 200 200">
      <circle cx="100" cy="100" r="85" fill="#111"/>
      <g id="bands"></g>
      <g id="scale"></g>
      <path id="arc" fill="none" stroke-width="14" stroke-linecap="round"/>
      <line id="needle" x1="100" y1="100" x2="100" y2="25" stroke="#fff" stroke-width="4"/>
      <text id="value" x="100" y="128" fill="#fff" font-size="30" text-anchor="middle">0</text>
      <text x="100" y="152" fill="#aaa" font-size="16" text-anchor="middle">${unit}</text>
    </svg>`;

    this.arc=el.querySelector("#arc");
    this.needle=el.querySelector("#needle");
    this.valueText=el.querySelector("#value");
    this.scale=el.querySelector("#scale");
    this.bandsEl=el.querySelector("#bands");

    this.drawScale();
    this.drawBands();
  }

  polar(v,r){
    let a=(v-this.min)/(this.max-this.min)*180-90;
    a*=Math.PI/180;
    return [100+r*Math.cos(a),100+r*Math.sin(a)];
  }

  drawBands(){
    for(const b of this.bands){
      let [x1,y1]=this.polar(b.from,85);
      let [x2,y2]=this.polar(b.to,85);
      this.bandsEl.innerHTML+=
        `<path d="M ${x1} ${y1} A 85 85 0 0 1 ${x2} ${y2}"
         stroke="${b.color}" stroke-width="14" fill="none" opacity=".35"/>`;
    }
  }

  drawScale(){
    for(let v=this.min;v<=this.max;v+=10){
      let [x1,y1]=this.polar(v,72);
      let [x2,y2]=this.polar(v,82);
      let [xt,yt]=this.polar(v,60);
      this.scale.innerHTML+=`
        <line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="#666" stroke-width="2"/>
        <text x="${xt}" y="${yt+4}" fill="#aaa" font-size="10" text-anchor="middle">${v}</text>`;
    }
  }

  set(v){
    v=Math.max(this.min,Math.min(this.max,v));
    this.valueText.textContent=v.toFixed(1);

    let ang=(v-this.min)/(this.max-this.min)*180-90;
    this.needle.setAttribute("transform",`rotate(${ang} 100 100)`);

    let color="#007bff";
    for(const z of this.zones) if(v>=z.from&&v<=z.to) color=z.color;
    this.arc.setAttribute("stroke",color);

    let [x,y]=this.polar(v,85);
    this.arc.setAttribute("d",`M 15 100 A 85 85 0 0 1 ${x} ${y}`);
  }
}

/* ===== INIT ===== */
let tempGauge,rssiGauge,temp2Gauge;

function init(){
  tempGauge=new NiceGauge(
    temp_gauge,0,120,"¬∞C",
    [
      {from:0,to:85,color:"#007bff"},
      {from:85,to:120,color:"#ff3333"}
    ],
    [
      {from:0,to:75,color:"#004cff"},
      {from:75,to:85,color:"#3399ff"},
      {from:85,to:120,color:"#ff3333"}
    ]
  );

  rssiGauge=new NiceGauge(rssi_gauge,0,100,"%");
  temp2Gauge=new NiceGauge(temp2_gauge,-30,50,"¬∞C");

  loadData();
  setInterval(loadData,15000);
  setInterval(()=>wifi_time.innerHTML="üïí ƒåas "+new Date().toLocaleTimeString(),1000);
}

function loadData(){
  $.getJSON("https://api.thingspeak.com/channels/260804/feed/last.json?api_key=JXC3WDDU4WH71K93",d=>{
    let t=parseFloat(d.field1);
    let s=parseFloat(d.field2);
    if(!isNaN(t)){
      tempGauge.set(t);
      temp_gauge.classList.toggle("blink",t>85);
    }
    if(!isNaN(s)){
      rssiGauge.set(s);
      signal_state.innerHTML=s>70?"üì∂ V√Ωborn√Ω sign√°l":s>40?"üì° Dobr√Ω sign√°l":"‚ö†Ô∏è Slab√Ω sign√°l";
    }
  });

  $.getJSON("https://api.thingspeak.com/channels/231269/feed/last.json",d=>{
    let t2=parseFloat(d.field4);
    if(!isNaN(t2)) temp2Gauge.set(t2);
  });
}

fs_btn.onclick=()=>document.fullscreenElement
  ?document.exitFullscreen()
  :document.documentElement.requestFullscreen();

init();
</script>
</body>
</html>
